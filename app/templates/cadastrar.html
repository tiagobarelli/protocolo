{% extends "base.html" %}
{% block title %}Cadastrar Protocolo - Sistema Interno{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/cadastrar.css') }}">
{% endblock %}
{% block content %}
<button type="button" class="hamburger-btn" onclick="toggleSidebar()">
  <i class="ph ph-list"></i>
</button>
<div class="sidebar-overlay"></div>

<div class="app-layout">
  {% include "partials/sidebar.html" %}

  <main class="main-content">
<div class="overlay" id="overlay"><div class="spinner"></div></div>
<div class="container">
  <div id="formView">
    <div class="page-header">
      <h1><i class="ph ph-file-plus" style="color: var(--accent);"></i> Cadastro de Protocolo</h1>
      <p>Preencha os dados abaixo. A inserção do advogado é obrigatória para inventários, divórcios, usucapião e adjudicação.</p>
    </div>
    <div class="card">
      <div id="formMsg" class="msg-box"></div>
      <div class="form-section">
        <div class="section-title"><i class="ph ph-user"></i> Interessado</div>
        <div class="form-row">
          <div class="form-group small">
            <label for="tipoPessoa">Tipo</label>
            <select id="tipoPessoa">
              <option value="cpf">Pessoa Física (CPF)</option>
              <option value="cnpj">Pessoa Jurídica (CNPJ)</option>
            </select>
          </div>
          <div class="form-group">
            <label for="documento"><span id="docLabel">CPF</span> <span class="hint" id="docHint">— digite e saia do campo para buscar</span></label>
            <div class="search-field-wrapper">
              <input type="text" id="documento" placeholder="000.000.000-00" maxlength="18" autocomplete="off">
              <span class="search-status" id="searchStatus"></span>
            </div>
          </div>
        </div>
        <div class="form-row single">
          <div class="form-group">
            <label for="nomeInteressado">Nome Completo</label>
            <input type="text" id="nomeInteressado" placeholder="Ex: João da Silva" autocomplete="name">
          </div>
        </div>
        <div id="alertaCliente" class="alerta-inline" style="display:none;"></div>
        <div class="form-row">
          <div class="form-group">
            <label for="telefone">Telefone <span class="hint">(Opcional)</span></label>
            <input type="text" id="telefone" placeholder="(00) 00000-0000" maxlength="15" autocomplete="tel">
          </div>
          <div class="form-group">
            <label for="email">E-mail <span class="hint">(Opcional)</span></label>
            <input type="text" id="email" placeholder="exemplo@email.com" autocomplete="email">
          </div>
        </div>
        <div id="clienteInfo" class="msg-box"></div>
      </div>
      <div class="form-section">
        <div class="section-title"><i class="ph ph-gavel"></i> Advogado</div>
        <div class="toggle-row">
          <input type="checkbox" id="toggleAdvogado" autocomplete="off">
          <label for="toggleAdvogado">Este protocolo possui advogado?</label>
        </div>
        <div class="collapsible" id="advogadoSection">
          <div class="form-row single">
            <div class="form-group">
              <label for="nomeAdvogado">Nome do Advogado <span class="hint">— Busque na base de dados</span></label>
              <div class="autocomplete-wrapper">
                <input type="text" id="nomeAdvogado" placeholder="Comece a digitar o nome..." autocomplete="off">
                <div class="autocomplete-list" id="advAutoList"></div>
              </div>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="cpfAdvogado">CPF</label>
              <input type="text" id="cpfAdvogado" placeholder="000.000.000-00" maxlength="14" autocomplete="off">
            </div>
            <div class="form-group">
              <label for="oabAdvogado">OAB</label>
              <input type="text" id="oabAdvogado" placeholder="Ex: 123456/SP" autocomplete="off">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="telefoneAdvogado">Telefone</label>
              <input type="text" id="telefoneAdvogado" placeholder="(00) 00000-0000" maxlength="15" autocomplete="tel">
            </div>
            <div class="form-group">
              <label for="emailAdvogado">E-mail</label>
              <input type="text" id="emailAdvogado" placeholder="exemplo@email.com" autocomplete="email">
            </div>
          </div>
          <div id="advogadoInfo" class="msg-box"></div>
        </div>
      </div>
      <div class="form-section">
        <div class="section-title"><i class="ph ph-file-text"></i> Dados do Protocolo</div>
        <div class="form-row">
          <div class="form-group">
            <label for="numProtocolo">Número do Protocolo <span class="hint">(Gerado pelo Siplan)</span></label>
            <input type="text" id="numProtocolo" placeholder="Ex: 2026-001234" autocomplete="off">
          </div>
          <div class="form-group small">
            <label for="dataEntrada">Data de Entrada</label>
            <input type="date" id="dataEntrada" readonly>
          </div>
          <div class="form-group small">
            <label for="agendadoPara">Agendamento <span class="hint">(Opcional)</span></label>
            <input type="date" id="agendadoPara" autocomplete="off">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="servico">Serviço</label>
            <select id="servico"><option value="">Carregando...</option></select>
          </div>
          <div class="form-group">
            <label for="responsavel">Responsável</label>
            <select id="responsavel"><option value="">Carregando...</option></select>
          </div>
          <div class="form-group small">
            <label for="depositoPrevio">Depósito Prévio</label>
            <input type="text" id="depositoPrevio" placeholder="R$ 0,00" maxlength="18" autocomplete="off">
          </div>
        </div>
        <div class="form-row single">
          <div class="form-group">
            <label for="detalhamentos">Detalhamentos / Observações</label>
            <div class="md-grid">
              <div class="md-editor-container">
                <div class="md-toolbar">
                  <button type="button" class="md-btn" onclick="addMarkdown('bold')" title="Negrito"><i class="ph ph-text-b"></i></button>
                  <button type="button" class="md-btn" onclick="addMarkdown('italic')" title="Itálico"><i class="ph ph-text-italic"></i></button>
                  <button type="button" class="md-btn" onclick="addMarkdown('list')" title="Lista"><i class="ph ph-list-bullets"></i></button>
                  <button type="button" class="md-btn" onclick="addMarkdown('heading')" title="Título"><i class="ph ph-text-h-two"></i></button>
                  <button type="button" class="md-btn" onclick="addMarkdown('code')" title="Código"><i class="ph ph-code"></i></button>
                  <button type="button" class="md-btn" onclick="addMarkdown('checklist')" title="Checklist"><i class="ph ph-check-square"></i></button>
                  <button type="button" class="md-btn" onclick="addMarkdown('hr')" title="Separador"><i class="ph ph-minus"></i></button>
                </div>
                <textarea id="detalhamentos" placeholder="Escreva observações aqui..." autocomplete="off"></textarea>
              </div>
              <div id="detalhamentosPreview" class="md-preview" aria-live="polite"><div class="md-placeholder">Pré-visualização...</div></div>
            </div>
          </div>
        </div>
      </div>
      <div class="btn-row">
        <button type="button" class="btn btn-secondary" onclick="limparFormulario()"><i class="ph ph-eraser"></i> Limpar</button>
        <button type="button" class="btn btn-primary" id="btnCadastrar" onclick="cadastrarProtocolo()"><i class="ph ph-check-circle"></i> Cadastrar Protocolo</button>
      </div>
    </div>
  </div>
</div>
  </main>
</div>
{% endblock %}
{% block extra_js %}
<script src="{{ url_for('static', filename='vendor/marked/marked.umd.js') }}"></script>
<script>
window.TEMPLATES_SERVICO = {
  "Certidão notarial": {{ template_certidao | tojson }}
};
</script>
<script src="{{ url_for('static', filename='js/cadastrar.js') }}"></script>
{% endblock %}
